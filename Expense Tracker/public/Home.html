<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center">Sign In</h2>
        <form action="/api/add-expense" method="POST" style="max-width: 500px; margin: 0 auto;">
            <div class="mb-3">
                <label for="amount" class="form-label">Choose Expense Amount</label>
                <input type="number" class="form-control" id="amount" name="amount" required>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <input type="text" class="form-control" id="description" name="description" required>
            </div>

            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select name="category" id="category" class="form-select">
                  <option value="Food">Food</option>
                  <option value="Transport">Transport</option>
                  <option value="Shopping">Shopping</option>
                  <option value="Other">Other</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary w-100">Add Expenses</button>
        </form>

    </div>

    <div class="container mt-5">
        <h2 class="text-center">Your Expenses</h2>

        <!-- Table to display expenses -->
        <div class="mt-4">
            <table class="table table-bordered" id="expenses-table">
                <thead>
                    <tr>
                        <th>Amount</th>
                        <th>Description</th>
                        <th>Category</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Expenses will be populated here via JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Logout Button -->
<div class="text-center mt-3">
    <a href="/logout" class="btn btn-danger">Logout</a>
</div>

    <!-- Bootstrap JS (Optional for interactivity) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
     
     <!-- JavaScript to fetch and display expenses -->
     <script>
        // Function to fetch expenses and display them in the table
        async function loadExpenses() {
            try {
                const response = await fetch('/api/home'); // Fetch expenses from the API
                const expenses = await response.json(); // Parse the response JSON

                const tableBody = document.querySelector("#expenses-table tbody");

                // Clear the table before populating it
                tableBody.innerHTML = '';

                // If no expenses, show a message
                if (expenses.length === 0) {
                    const noDataRow = document.createElement("tr");
                    const noDataCell = document.createElement("td");
                    noDataCell.colSpan = 4; // Span across all columns
                    noDataCell.textContent = "No expenses found.";
                    noDataRow.appendChild(noDataCell);
                    tableBody.appendChild(noDataRow);
                    return;
                }

                // Loop through the expenses and append rows to the table
                expenses.forEach(expense => {
                    const row = document.createElement("tr");

                    const amountCell = document.createElement("td");
                    amountCell.textContent = expense.amount;
                    row.appendChild(amountCell);

                    const descriptionCell = document.createElement("td");
                    descriptionCell.textContent = expense.description;
                    row.appendChild(descriptionCell);

                    const categoryCell = document.createElement("td");
                    categoryCell.textContent = expense.category;
                    row.appendChild(categoryCell);

                    const dateCell = document.createElement("td");
                    dateCell.textContent = new Date(expense.createdAt).toLocaleDateString();
                    row.appendChild(dateCell);

                    // Create a delete button for each expense
                    const actionsCell = document.createElement("td");
                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Delete";
                    deleteButton.className = "btn btn-danger";
                    deleteButton.onclick = function () {
                        deleteExpense(expense.id);
                    };
                    actionsCell.appendChild(deleteButton);
                    row.appendChild(actionsCell);

                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error("Error loading expenses:", error);
            }
        }

      
        // Function to delete an expense
        async function deleteExpense(expenseId) {
            if (confirm("Are you sure you want to delete this expense?")) {
                try {
                    const response = await fetch(`/api/expense/${expenseId}`, {
                        method: 'DELETE',
                    });

                    const result = await response.json();
                    if (response.ok) {
                        alert(result.message);
                        loadExpenses(); // Reload expenses after successful deletion
                    } else {
                        alert("Error: " + result.message);
                    }
                } catch (error) {
                    console.error("Error deleting expense:", error);
                    alert("Error deleting expense");
                }
            }
        }

        // Load expenses when the page loads
        window.onload = loadExpenses;
    </script>

</body>
</html>
